<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dsekai: dsekai</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxstyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="dsekai.bmp"/></td>
  <td id="projectalign">
   <div id="projectname">dsekai
   </div>
   <div id="projectbrief">World engine for retrocomputers.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">dsekai </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p><a href="https://www.codiga.io"><img src="https://api.codiga.io/project/29729/score/svg" alt="Code Grade" class="inline"/></a></p>
<ul>
<li>dsekai<ul>
<li>Roadmap</li>
<li>Documentation</li>
</ul>
</li>
<li>Building<ul>
<li>Datafiles</li>
<li>Platforms</li>
</ul>
</li>
<li>Modding<ul>
<li>Mapping</li>
<li>Skinning</li>
<li><a class="el" href="group__scripting.html">Scripting</a></li>
</ul>
</li>
<li>Tools<ul>
<li>mkresh</li>
<li>convert</li>
<li>map2asn</li>
<li>headpack</li>
</ul>
</li>
</ul>
<div class="image">
<img src="overwrld.png" alt=""/>
<div class="caption">
Overworld Screenshot</div></div>
    <p><b>dsekai has been superceded by the <a href="https://codeberg.org/indigoparadox/numoon/">numoon</a> project, which is based on maug. Not all of the features are there yet, but that framework is structured in a way that affords a lot more flexibility and code-sharing between related projects. Please look there for updates!</b></p>
<p>dsekai is an extremely minimal world engine, intended to run on very old hardware. It is originally targeted to the 8086/8088 CPU with the intention to make it more portable later. See below for a list of supported platforms.</p>
<p>This project is being built around/in tandem with the unilayer project, in order to create a somewhat-universal framework/library for games on legacy/weird platforms.</p>
<p>There are also some rough examples of CGA graphics programming in unilayer/graphics/dosg.c, if that's what you're into.</p>
<h1>Roadmap</h1>
<p>Features that are planned include:</p>
<ul>
<li>ASN.1 save dumps.</li>
<li>Housing system based on in-game map editing.</li>
<li>Item usage and crafting.</li>
<li>Minimal resource use (shooting for &lt;500k RAM).</li>
<li>Multi-height raycasting POV support.</li>
<li>Compile script source files as part of JSON loading.</li>
</ul>
<h2>Linking and Compiling Considerations</h2>
<p>Ideally, this engine will compile with legacy compilers as a general rule. For this reason, the following rules/limitations should be observed within the codebase:</p>
<ul>
<li>C should be limited to C89/ANSI C in general. No C99 features should be used. In some cases, not all ANSI features should be used.</li>
<li>Except within platform-specific modules that can definitely handle it, dynamic allocation should also be avoided.</li>
<li>Except within platform-specific modules that can definitely use them, external dependencies should be avoided.</li>
</ul>
<p>In general, these restrictions are relaxed for items in the tools/ and check/ subdirectories (though these should also be limited to C89). For this reason, items in the src/ directory should also avoid depending on items in the tools/ and check/ directories (except for in platform-specific modules that do not have these restrictions that may use the tools/ subdirectory. Nothing should depend on the check/ subdirectory).</p>
<p>Items in the tools/ and check/ subdirectories may depend on the src/ directory freely.</p>
<h2>API Coding Considerations</h2>
<p>In an attempt to keep the API consistent, functions should adhere to the following rules:</p>
<ul>
<li>Arguments should be in order of state modifiers <b>first</b>, followed by a pointer to the object being modified if no global state is modified <b>or</b> a pointer to the global state struct which should be auto-unlocked before it is accessed with engines_state_unlock().</li>
</ul>
<h1>Documentation</h1>
<p>Some attempt has been made at documentation with <a href="https://www.doxygen.nl/index.html">doxygen</a>. Simply run doxygen in the project root in order to generate HTML documentation under doc/.</p>
<p>This documentation is also available at <a href="https://indigoparadox.github.io/dsekai/">https://indigoparadox.github.io/dsekai/</a>.</p>
<p>This is a work in progress.</p>
<h1>Building</h1>
<p>Currently, this project uses GNU make to (cross-)build on a GNU/Linux system. Compilers and tools required depend on the desired platforms to build for.</p>
<p>For MS-DOS, the INCLUDE environment variable must be set to the location of the OpenWatcom header files (e.g. /opt/watcom/h).</p>
<p>The script pkgs.sh in the root directory should build the recommended set of packages if the proper compilers are installed.</p>
<h2>Datafiles</h2>
<p>This engine should be capable of retrieving assets (levels, graphics, etc) from different locations, depending on how it was built (e.g. ASN.1 vs JSON maps support). Aside from loading directly from the filesystem, it should be able to use OS-level resources embedded in the binary. On platforms without this facility, a rough approximation of this is emulated using [object embedding](headpack).</p>
<h2>Platforms</h2>
<p>The following platforms are currently supported:</p>
<ul>
<li><b>MS-DOS w/ CGA Graphics</b> (Maybe VGA graphics in the future...)</li>
<li><b>GNU/Linux with SDL</b> (May work with other POSIX platforms.)</li>
<li><b>Windows (16-bit/32-bit)</b></li>
<li><b>WebASM</b></li>
</ul>
<p>The following platforms are mostly functional, but still a little wonky:</p>
<ul>
<li><b>PalmOS &gt;= 3.5</b></li>
<li><b>GNU/Linux with Xlib</b> (May work with other POSIX platforms.)</li>
<li><b>GNU/Linux with NCurses</b> (May work with other POSIX platforms.)</li>
<li><b>Nintendo DS</b></li>
</ul>
<p>The following platforms are planned to be supported but not yet functional:</p>
<ul>
<li><b>Mac-OS 6/7</b></li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Platform   </th><th class="markdownTableHeadNone">Make Target   </th><th class="markdownTableHeadNone">Requirements    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">+MS-DOS   </td><td class="markdownTableBodyNone">bin/dsekai.exe   </td><td class="markdownTableBodyNone"><a href="https://github.com/open-watcom/open-watcom-v2">OpenWatcom</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SDL   </td><td class="markdownTableBodyNone">bin/dsekai   </td><td class="markdownTableBodyNone">SDL2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Xlib   </td><td class="markdownTableBodyNone">bin/dsekaix   </td><td class="markdownTableBodyNone">Xlib    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">PalmOS   </td><td class="markdownTableBodyNone">bin/dsekai.prc   </td><td class="markdownTableBodyNone"><a href="https://github.com/jichu4n/prc-tools-remix">PRCTools</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">+Win16   </td><td class="markdownTableBodyNone">bin/dsekai16.exe   </td><td class="markdownTableBodyNone"><a href="https://github.com/open-watcom/open-watcom-v2">OpenWatcom</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Win32   </td><td class="markdownTableBodyNone">bin/dsekai32.exe   </td><td class="markdownTableBodyNone"><a href="https://github.com/open-watcom/open-watcom-v2">OpenWatcom</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MacOS 7   </td><td class="markdownTableBodyNone">bin/dsekai16.dsk   </td><td class="markdownTableBodyNone"><a href="https://github.com/autc04/Retro68">Retro68</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">NDS   </td><td class="markdownTableBodyNone">bin/dsekai.nds   </td><td class="markdownTableBodyNone"><a href="https://devkitpro.org/">DevKitPro</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WebASM   </td><td class="markdownTableBodyNone">bin/dsekai.js   </td><td class="markdownTableBodyNone"><a href="https://github.com/emscripten-core/emscripten">emscripten</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Curses   </td><td class="markdownTableBodyNone">bin/dsekait   </td><td class="markdownTableBodyNone">NCurses   </td></tr>
</table>
<ul>
<li>+ Platforms marked with + do not support JSON tilemaps directly.</li>
</ul>
<p>Just using "make" will attempt to build all currently working targets with OS-level resources and statically compiled maps.</p>
<h2>Platform-Specific Notes</h2>
<h3>MS-DOS</h3>
<p>dsekai is being written to support MS-DOS in real mode on an 8086. This means that it only uses conventional memory. This leads to some technical considerations:</p>
<ul>
<li>dsekai uses overlays to page unused engines to disk during execution. The engine .ovl files must be kept with the dsekai.exe file for it to work properly! Please see the Makefile.dos for more information.</li>
</ul>
<h1>Mechanics</h1>
<h2>Items</h2>
<p>Items are defined in each tilemap in an array. Through scripts, items can be coped from the item definition array into the player's inventory where they can then be used even if the player is on a different tilemap.</p>
<h2>Crops</h2>
<p>Crops are also defined in each tilemap in an array. However, seeds in the player's inventory only reference the crop GID. This means that crops can only grow on a tilemap in which they are defined. This also means that crop GIDs MUST NOT collide between tilemaps.</p>
<h2>Crops</h2>
<h1>Modding</h1>
<h2>Mapping</h2>
<p>Maps are stored as JSON files in the format used by the <a href="https://github.com/mapeditor/tiled">Tiled</a> map editor.</p>
<p>Please see map_field.json in the assets directory for an example.</p>
<p>The following special considerations should be observed for the dsekai engine:</p>
<ul>
<li><a class="el" href="group__scripting.html">Scripts</a> are loaded from the map file according to the rules in that section.</li>
<li>NPC (or "mobile") spawns are stored in an objects layer called "objects". The engine selects the NPC sprite based on its name and its script based on a custom property called "script".</li>
<li>The static layer of the map is loaded from a layer called "terrain".</li>
</ul>
<h2>Skinning</h2>
<p>TBA</p>
<h2>Scripting</h2>
<p>Information on scripting including detailed instruction reference has been <a href="https://indigoparadox.github.io/dsekai/group__scripting__instructions__sect.html">moved into the documentation</a>.</p>
<p>For the time being, the script compiler can be compiled by using <code>make bin/compile</code>, and then running <code>bin/compile &lt;path-to-script.s&gt;</code> to generate bytecode output that can be pasted into tilemaps.</p>
<p>See <code>assets/m\_field</code> for some example scripts.</p>
<h1>Tools</h1>
<p>Included in the tools/ subdirectory are a few tools required for preprocessing and compiling. These include tools for preprocessing resources from easier-to-edit formats to more compact formats for resource-limited platforms, as well as tools for packing up resources as part of compilation.</p>
<h2>mkresh</h2>
<p>Creates header files with resource listings to be included as OS-level resources.</p>
<h2>convert</h2>
<p>Converts between various image formats common to resource-limited platforms.</p>
<h3>Usage</h3>
<p>./bin/convert [options] -ic &lt;in_fmt&gt; -oc &lt;out_fmt&gt; -if &lt;in_file&gt; -of &lt;out_file&gt;</p>
<h3>Options:</h3>
<ul>
<li>-ic [In format extension from Input Formats table.]</li>
<li>-oc [Out format extension from Output Formats table.]</li>
</ul>
<h3>CGA options:</h3>
<p>These options only apply to raw CGA files:</p>
<ul>
<li>-ib [in bpp] (defaults to 2)</li>
<li>-ob [out bpp] (defaults to input bpp)</li>
<li>-iw [in width] (requried for CGA in)</li>
<li>-ih [in height] (required for CGA in)</li>
<li>-il [in line padding] (full-screen uses 192)</li>
<li>-ol [out line padding]</li>
</ul>
<h3>Input Formats</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Extension    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Windows Bitmap   </td><td class="markdownTableBodyNone">bmp    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Mac Icon   </td><td class="markdownTableBodyNone">icns    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CGA Memory Dump   </td><td class="markdownTableBodyNone">cga   </td></tr>
</table>
<h3>Output Formats</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Extension    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Windows Bitmap   </td><td class="markdownTableBodyNone">bmp    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Mac Icon   </td><td class="markdownTableBodyNone">icns    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CGA Memory Dump   </td><td class="markdownTableBodyNone">cga   </td></tr>
</table>
<h2>map2asn</h2>
<p>Converts maps from JSON to a more compact ASN.1 representation for use with resource-limited platforms.</p>
<p>Usage: map2asn &lt;JSON tilemap input path&gt; &lt;ASN.1 tilemap output path&gt;</p>
<h2>headpack</h2>
<p>Packs resources into #include-able header files to be inserted directly into the final binary.</p>
<p>Usage: headpack &lt;header path&gt; &lt;paths to files to encode&gt; </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
